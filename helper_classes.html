<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WordPress Behat Extension</title>

    <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic'
          rel='stylesheet' type='text/css'>

    <link rel="stylesheet" href="https://stephenharris.github.io/WordPressBehatExtension/css/grid.css" type="text/css"/>
    <link rel="stylesheet" href="https://stephenharris.github.io/WordPressBehatExtension/css/theme.css" type="text/css"/>
    <link rel="stylesheet" href="//cdn.jsdelivr.net/highlight.js/9.9.0/styles/dark.min.css">
</head>
<body class="wy-body-for-nav">

    <header id="intro">
        <div class="container">
            <a href="https://stephenharris.github.io/WordPressBehatExtension/"><h1>WordPress Behat Extension</h1></a>
            <p>Automatted end-user testing for WordPress with Behat 3</p>
        </div>
    </header>

    <div class="container">

        <section class="col-md-9">

                        <div class="wy-nav-content">
                <div class="rst-content">
                    <div role="main" class="document">
                        <h1 id="helper-classes">Helper Classes</h1>
<p>While WordPressBehatExtension provides a number of steps relating to WordPress and its UI, it also makes it very easy to define your own steps for your plug-in or theme.</p>
<p>Firstly all WordPress functions and classes are available in you context classes.</p>
<p>In addition WordPressBehatExtension provides a layer to sit between your context definitions and WordPress. They take the form of <a href="http://php.net/manual/en/language.oop5.traits.php">traits</a> and provide helpful methods for interacting with WordPress.</p>
<h2 id="an-example-custom-post-types">An example: custom post types</h2>
<p>Let's suppose you are developing plug-in which sells books. An example feature might be:</p>
<pre><code>Scenario: I can view details of the book
  Given I have a vanilla wordpress installation
    | name         | email             | username | password |
    | My Book Shop | admin@example.com | admin    | password |
  And there are books
    | name                   | author     | ISBN       | price (£) |
    | To Kill A Mocking Bird | Harper Lee | 1455538965 | 4.74      |

  And I am on the homepage
  Then I should see "To Kill A Mocking Bird"

  When I follow "To Kill A Mocking Bird"
  Then I should see "Author: Harper Lee"
  And I should see "ISBN: 1455538965"</code></pre>
<p>Clearly, part of the itended functionality for this (very simplistic) plug-in is that it lists the books on the homepage, and that clicking the link through the single book page should list the details of the book, namely the author's name and the ISBN number.</p>
<p>If we try to run this test we find that there is no definition for the <code>And there are books</code> step:</p>
<pre><code>--- FeatureContext has missing steps. Define them with these snippets:

    /**
     * @Given there are books
     */
    public function thereAreBooks(TableNode $table)
    {
        throw new PendingException();
    }</code></pre>
<p>While we can use <code>wp_insert_post()</code> to create the book in this step we can instead use the <code>\StephenHarris\WordPressBehatExtension\Context\PostTypes\WordPressPostTrait;</code>:</p>
<pre><code class="language-php">use Behat\Behat\Context\Context,
    Behat\Behat\Context\SnippetAcceptingContext;

/**
 * Features context.
 */
class FeatureContext extends RawMinkContext implements Context, SnippetAcceptingContext {
    use \StephenHarris\WordPressBehatExtension\Context\PostTypes\WordPressPostTrait;

    /**
     * @Given there are books
     */
    public function thereAreBooks(TableNode $table)
    {
        foreach ($table-&gt;getHash() as $bookData) {
            $bookID = $postData = array(
                'post_title' =&gt; $bookData['title']
            );
            $this-&gt;insert($postData);
            update_post_meta($bookID, 'book_author', $bookData['author']);
            update_post_meta($bookID, 'isbn', $bookData['ISBN']);
            update_post_meta($bookID, 'price', $bookData['price (£)']);
        }
    }

}</code></pre>
<p>What has using <code>WordPressPostTrait;</code> bought us? It automatically checks that the post has been created successfully. If it does not, it throws an exception with an informative error message which fails the scenerio. </p>
<p>By using this helper class we can keep our step definition clean of any sanity-checking code, making it easier to read.</p>
                    </div>
                </div>
            </div>

        </section>

        <nav class="col-md-3">

            <div role="navigation" aria-label="main navigation">
                <ul>
                                            <li class="toctree-l1 ">
                            <a class="reference internal "
                               href="https://stephenharris.github.io/WordPressBehatExtension/Recipes.html">
                                Quick start Recipes
                            </a>
                        </li>
                                            <li class="toctree-l1 ">
                            <a class="reference internal "
                               href="https://stephenharris.github.io/WordPressBehatExtension/Contexts.html">
                                Contexts
                            </a>
                        </li>
                                            <li class="toctree-l1 ">
                            <a class="reference internal "
                               href="https://stephenharris.github.io/WordPressBehatExtension/Step_Definitions.html">
                                Step Definitions
                            </a>
                        </li>
                                            <li class="toctree-l1 ">
                            <a class="reference internal "
                               href="https://stephenharris.github.io/WordPressBehatExtension/Helper_Classes.html">
                                Helper Classes
                            </a>
                        </li>
                                    </ul>
            </div>
            &nbsp;
        </nav>

    </div>

    <footer class="container">
       <hr/>
                Built with <a href="http://couscous.io/">Couscous</a>.
    </footer>

    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/languages/yaml.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/languages/gherkin.min.js"></script>

    <script>
        $(function() {
            hljs.initHighlighting();
        });
    </script>

</body>
</html>
